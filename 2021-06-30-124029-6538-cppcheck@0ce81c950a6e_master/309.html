
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - clib (cppcheck 2.3-1)</title>
    <link rel="stylesheet" href="style.css">
    <style>
pre { line-height: 125%; margin: 0; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(id) {
        var elements = document.querySelectorAll("." + id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("d-none");
        }
      }

      function toggleAll() {
        var elements = document.querySelectorAll("input");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var el = elements[i];

          if (el.checked) {
            el.checked = false;
          } else {
            el.checked = true;
          }

          toggleDisplay(el.id);
        }
      }
      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="header" class="header">
      <h1>Cppcheck report - clib (cppcheck 2.3-1): glib/gstringchunk.c</h1>
    </div>
    <div class="wrapper">
      <div id="menu">
       <p id="filename"><a href="index.html">Defects:</a> gstringchunk.c</p>
<a href="309.html#line-0"> toomanyconfigs 0</a>
    </div>
    <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cm">/* GLIB - Library of useful routines for C programming</span>
<a name="line-2"></a><span class="cm"> * Copyright (C) 1995-1997  Peter Mattis, Spencer Kimball and Josh MacDonald</span>
<a name="line-3"></a><span class="cm"> *</span>
<a name="line-4"></a><span class="cm"> * This library is free software; you can redistribute it and/or</span>
<a name="line-5"></a><span class="cm"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="line-6"></a><span class="cm"> * License as published by the Free Software Foundation; either</span>
<a name="line-7"></a><span class="cm"> * version 2.1 of the License, or (at your option) any later version.</span>
<a name="line-8"></a><span class="cm"> *</span>
<a name="line-9"></a><span class="cm"> * This library is distributed in the hope that it will be useful,</span>
<a name="line-10"></a><span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="line-11"></a><span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="line-12"></a><span class="cm"> * Lesser General Public License for more details.</span>
<a name="line-13"></a><span class="cm"> *</span>
<a name="line-14"></a><span class="cm"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="line-15"></a><span class="cm"> * License along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="line-16"></a><span class="cm"> */</span>
<a name="line-17"></a>
<a name="line-18"></a><span class="cm">/*</span>
<a name="line-19"></a><span class="cm"> * Modified by the GLib Team and others 1997-2000.  See the AUTHORS</span>
<a name="line-20"></a><span class="cm"> * file for a list of people on the GLib Team.  See the ChangeLog</span>
<a name="line-21"></a><span class="cm"> * files for a list of changes.  These files are distributed with</span>
<a name="line-22"></a><span class="cm"> * GLib at ftp://ftp.ctk.org/pub/ctk/.</span>
<a name="line-23"></a><span class="cm"> */</span>
<a name="line-24"></a>
<a name="line-25"></a><span class="cm">/*</span>
<a name="line-26"></a><span class="cm"> * MT safe</span>
<a name="line-27"></a><span class="cm"> */</span>
<a name="line-28"></a>
<a name="line-29"></a><span class="cp">#include</span> <span class="cpf">&quot;config.h&quot;</span><span class="cp"></span>
<a name="line-30"></a>
<a name="line-31"></a><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<a name="line-32"></a>
<a name="line-33"></a><span class="cp">#include</span> <span class="cpf">&quot;gstringchunk.h&quot;</span><span class="cp"></span>
<a name="line-34"></a>
<a name="line-35"></a><span class="cp">#include</span> <span class="cpf">&quot;ghash.h&quot;</span><span class="cp"></span>
<a name="line-36"></a><span class="cp">#include</span> <span class="cpf">&quot;gslist.h&quot;</span><span class="cp"></span>
<a name="line-37"></a><span class="cp">#include</span> <span class="cpf">&quot;gmessages.h&quot;</span><span class="cp"></span>
<a name="line-38"></a>
<a name="line-39"></a><span class="cp">#include</span> <span class="cpf">&quot;gutils.h&quot;</span><span class="cp"></span>
<a name="line-40"></a>
<a name="line-41"></a><span class="cm">/**</span>
<a name="line-42"></a><span class="cm"> * SECTION:string_chunks</span>
<a name="line-43"></a><span class="cm"> * @title: String Chunks</span>
<a name="line-44"></a><span class="cm"> * @short_description: efficient storage of groups of strings</span>
<a name="line-45"></a><span class="cm"> *</span>
<a name="line-46"></a><span class="cm"> * String chunks are used to store groups of strings. Memory is</span>
<a name="line-47"></a><span class="cm"> * allocated in blocks, and as strings are added to the #GStringChunk</span>
<a name="line-48"></a><span class="cm"> * they are copied into the next free position in a block. When a block</span>
<a name="line-49"></a><span class="cm"> * is full a new block is allocated.</span>
<a name="line-50"></a><span class="cm"> *</span>
<a name="line-51"></a><span class="cm"> * When storing a large number of strings, string chunks are more</span>
<a name="line-52"></a><span class="cm"> * efficient than using g_strdup() since fewer calls to malloc() are</span>
<a name="line-53"></a><span class="cm"> * needed, and less memory is wasted in memory allocation overheads.</span>
<a name="line-54"></a><span class="cm"> *</span>
<a name="line-55"></a><span class="cm"> * By adding strings with g_string_chunk_insert_const() it is also</span>
<a name="line-56"></a><span class="cm"> * possible to remove duplicates.</span>
<a name="line-57"></a><span class="cm"> *</span>
<a name="line-58"></a><span class="cm"> * To create a new #GStringChunk use g_string_chunk_new().</span>
<a name="line-59"></a><span class="cm"> *</span>
<a name="line-60"></a><span class="cm"> * To add strings to a #GStringChunk use g_string_chunk_insert().</span>
<a name="line-61"></a><span class="cm"> *</span>
<a name="line-62"></a><span class="cm"> * To add strings to a #GStringChunk, but without duplicating strings</span>
<a name="line-63"></a><span class="cm"> * which are already in the #GStringChunk, use</span>
<a name="line-64"></a><span class="cm"> * g_string_chunk_insert_const().</span>
<a name="line-65"></a><span class="cm"> *</span>
<a name="line-66"></a><span class="cm"> * To free the entire #GStringChunk use g_string_chunk_free(). It is</span>
<a name="line-67"></a><span class="cm"> * not possible to free individual strings.</span>
<a name="line-68"></a><span class="cm"> */</span>
<a name="line-69"></a>
<a name="line-70"></a><span class="cm">/**</span>
<a name="line-71"></a><span class="cm"> * GStringChunk:</span>
<a name="line-72"></a><span class="cm"> *</span>
<a name="line-73"></a><span class="cm"> * An opaque data structure representing String Chunks.</span>
<a name="line-74"></a><span class="cm"> * It should only be accessed by using the following functions.</span>
<a name="line-75"></a><span class="cm"> */</span>
<a name="line-76"></a><span class="k">struct</span> <span class="nc">_GStringChunk</span>
<a name="line-77"></a><span class="p">{</span>
<a name="line-78"></a>  <span class="n">GHashTable</span> <span class="o">*</span><span class="n">const_table</span><span class="p">;</span>
<a name="line-79"></a>  <span class="n">GSList</span>     <span class="o">*</span><span class="n">storage_list</span><span class="p">;</span>
<a name="line-80"></a>  <span class="n">gsize</span>       <span class="n">storage_next</span><span class="p">;</span>
<a name="line-81"></a>  <span class="n">gsize</span>       <span class="n">this_size</span><span class="p">;</span>
<a name="line-82"></a>  <span class="n">gsize</span>       <span class="n">default_size</span><span class="p">;</span>
<a name="line-83"></a><span class="p">};</span>
<a name="line-84"></a>
<a name="line-85"></a><span class="cp">#define MY_MAXSIZE ((gsize)-1)</span>
<a name="line-86"></a>
<a name="line-87"></a><span class="k">static</span> <span class="kr">inline</span> <span class="n">gsize</span>
<a name="line-88"></a><span class="n">nearest_power</span> <span class="p">(</span><span class="n">gsize</span> <span class="n">base</span><span class="p">,</span>
<a name="line-89"></a>               <span class="n">gsize</span> <span class="n">num</span><span class="p">)</span>
<a name="line-90"></a><span class="p">{</span>
<a name="line-91"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;</span> <span class="n">MY_MAXSIZE</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<a name="line-92"></a>    <span class="p">{</span>
<a name="line-93"></a>      <span class="k">return</span> <span class="n">MY_MAXSIZE</span><span class="p">;</span>
<a name="line-94"></a>    <span class="p">}</span>
<a name="line-95"></a>  <span class="k">else</span>
<a name="line-96"></a>    <span class="p">{</span>
<a name="line-97"></a>      <span class="n">gsize</span> <span class="n">n</span> <span class="o">=</span> <span class="n">base</span><span class="p">;</span>
<a name="line-98"></a>
<a name="line-99"></a>      <span class="k">while</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">)</span>
<a name="line-100"></a>        <span class="n">n</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-101"></a>
<a name="line-102"></a>      <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
<a name="line-103"></a>    <span class="p">}</span>
<a name="line-104"></a><span class="p">}</span>
<a name="line-105"></a>
<a name="line-106"></a><span class="cm">/**</span>
<a name="line-107"></a><span class="cm"> * g_string_chunk_new:</span>
<a name="line-108"></a><span class="cm"> * @size: the default size of the blocks of memory which are</span>
<a name="line-109"></a><span class="cm"> *     allocated to store the strings. If a particular string</span>
<a name="line-110"></a><span class="cm"> *     is larger than this default size, a larger block of</span>
<a name="line-111"></a><span class="cm"> *     memory will be allocated for it.</span>
<a name="line-112"></a><span class="cm"> *</span>
<a name="line-113"></a><span class="cm"> * Creates a new #GStringChunk.</span>
<a name="line-114"></a><span class="cm"> *</span>
<a name="line-115"></a><span class="cm"> * Returns: a new #GStringChunk</span>
<a name="line-116"></a><span class="cm"> */</span>
<a name="line-117"></a><span class="n">GStringChunk</span> <span class="o">*</span>
<a name="line-118"></a><span class="n">g_string_chunk_new</span> <span class="p">(</span><span class="n">gsize</span> <span class="n">size</span><span class="p">)</span>
<a name="line-119"></a><span class="p">{</span>
<a name="line-120"></a>  <span class="n">GStringChunk</span> <span class="o">*</span><span class="n">new_chunk</span> <span class="o">=</span> <span class="n">g_new</span> <span class="p">(</span><span class="n">GStringChunk</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<a name="line-121"></a>  <span class="n">gsize</span> <span class="n">actual_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-122"></a>
<a name="line-123"></a>  <span class="n">actual_size</span> <span class="o">=</span> <span class="n">nearest_power</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<a name="line-124"></a>
<a name="line-125"></a>  <span class="n">new_chunk</span><span class="o">-&gt;</span><span class="n">const_table</span>  <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-126"></a>  <span class="n">new_chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-127"></a>  <span class="n">new_chunk</span><span class="o">-&gt;</span><span class="n">storage_next</span> <span class="o">=</span> <span class="n">actual_size</span><span class="p">;</span>
<a name="line-128"></a>  <span class="n">new_chunk</span><span class="o">-&gt;</span><span class="n">default_size</span> <span class="o">=</span> <span class="n">actual_size</span><span class="p">;</span>
<a name="line-129"></a>  <span class="n">new_chunk</span><span class="o">-&gt;</span><span class="n">this_size</span>    <span class="o">=</span> <span class="n">actual_size</span><span class="p">;</span>
<a name="line-130"></a>
<a name="line-131"></a>  <span class="k">return</span> <span class="n">new_chunk</span><span class="p">;</span>
<a name="line-132"></a><span class="p">}</span>
<a name="line-133"></a>
<a name="line-134"></a><span class="cm">/**</span>
<a name="line-135"></a><span class="cm"> * g_string_chunk_free:</span>
<a name="line-136"></a><span class="cm"> * @chunk: a #GStringChunk</span>
<a name="line-137"></a><span class="cm"> *</span>
<a name="line-138"></a><span class="cm"> * Frees all memory allocated by the #GStringChunk.</span>
<a name="line-139"></a><span class="cm"> * After calling g_string_chunk_free() it is not safe to</span>
<a name="line-140"></a><span class="cm"> * access any of the strings which were contained within it.</span>
<a name="line-141"></a><span class="cm"> */</span>
<a name="line-142"></a><span class="kt">void</span>
<a name="line-143"></a><span class="n">g_string_chunk_free</span> <span class="p">(</span><span class="n">GStringChunk</span> <span class="o">*</span><span class="n">chunk</span><span class="p">)</span>
<a name="line-144"></a><span class="p">{</span>
<a name="line-145"></a>  <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">chunk</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-146"></a>
<a name="line-147"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span><span class="p">)</span>
<a name="line-148"></a>    <span class="n">g_slist_free_full</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span><span class="p">,</span> <span class="n">g_free</span><span class="p">);</span>
<a name="line-149"></a>
<a name="line-150"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">const_table</span><span class="p">)</span>
<a name="line-151"></a>    <span class="n">g_hash_table_destroy</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">const_table</span><span class="p">);</span>
<a name="line-152"></a>
<a name="line-153"></a>  <span class="n">g_free</span> <span class="p">(</span><span class="n">chunk</span><span class="p">);</span>
<a name="line-154"></a><span class="p">}</span>
<a name="line-155"></a>
<a name="line-156"></a><span class="cm">/**</span>
<a name="line-157"></a><span class="cm"> * g_string_chunk_clear:</span>
<a name="line-158"></a><span class="cm"> * @chunk: a #GStringChunk</span>
<a name="line-159"></a><span class="cm"> *</span>
<a name="line-160"></a><span class="cm"> * Frees all strings contained within the #GStringChunk.</span>
<a name="line-161"></a><span class="cm"> * After calling g_string_chunk_clear() it is not safe to</span>
<a name="line-162"></a><span class="cm"> * access any of the strings which were contained within it.</span>
<a name="line-163"></a><span class="cm"> *</span>
<a name="line-164"></a><span class="cm"> * Since: 2.14</span>
<a name="line-165"></a><span class="cm"> */</span>
<a name="line-166"></a><span class="kt">void</span>
<a name="line-167"></a><span class="n">g_string_chunk_clear</span> <span class="p">(</span><span class="n">GStringChunk</span> <span class="o">*</span><span class="n">chunk</span><span class="p">)</span>
<a name="line-168"></a><span class="p">{</span>
<a name="line-169"></a>  <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">chunk</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-170"></a>
<a name="line-171"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span><span class="p">)</span>
<a name="line-172"></a>    <span class="p">{</span>
<a name="line-173"></a>      <span class="n">g_slist_free_full</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span><span class="p">,</span> <span class="n">g_free</span><span class="p">);</span>
<a name="line-174"></a>
<a name="line-175"></a>      <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-176"></a>      <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_next</span> <span class="o">=</span> <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">default_size</span><span class="p">;</span>
<a name="line-177"></a>      <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">this_size</span>    <span class="o">=</span> <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">default_size</span><span class="p">;</span>
<a name="line-178"></a>    <span class="p">}</span>
<a name="line-179"></a>
<a name="line-180"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">const_table</span><span class="p">)</span>
<a name="line-181"></a>      <span class="n">g_hash_table_remove_all</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">const_table</span><span class="p">);</span>
<a name="line-182"></a><span class="p">}</span>
<a name="line-183"></a>
<a name="line-184"></a><span class="cm">/**</span>
<a name="line-185"></a><span class="cm"> * g_string_chunk_insert:</span>
<a name="line-186"></a><span class="cm"> * @chunk: a #GStringChunk</span>
<a name="line-187"></a><span class="cm"> * @string: the string to add</span>
<a name="line-188"></a><span class="cm"> *</span>
<a name="line-189"></a><span class="cm"> * Adds a copy of @string to the #GStringChunk.</span>
<a name="line-190"></a><span class="cm"> * It returns a pointer to the new copy of the string</span>
<a name="line-191"></a><span class="cm"> * in the #GStringChunk. The characters in the string</span>
<a name="line-192"></a><span class="cm"> * can be changed, if necessary, though you should not</span>
<a name="line-193"></a><span class="cm"> * change anything after the end of the string.</span>
<a name="line-194"></a><span class="cm"> *</span>
<a name="line-195"></a><span class="cm"> * Unlike g_string_chunk_insert_const(), this function</span>
<a name="line-196"></a><span class="cm"> * does not check for duplicates. Also strings added</span>
<a name="line-197"></a><span class="cm"> * with g_string_chunk_insert() will not be searched</span>
<a name="line-198"></a><span class="cm"> * by g_string_chunk_insert_const() when looking for</span>
<a name="line-199"></a><span class="cm"> * duplicates.</span>
<a name="line-200"></a><span class="cm"> *</span>
<a name="line-201"></a><span class="cm"> * Returns: a pointer to the copy of @string within</span>
<a name="line-202"></a><span class="cm"> *     the #GStringChunk</span>
<a name="line-203"></a><span class="cm"> */</span>
<a name="line-204"></a><span class="n">gchar</span><span class="o">*</span>
<a name="line-205"></a><span class="n">g_string_chunk_insert</span> <span class="p">(</span><span class="n">GStringChunk</span> <span class="o">*</span><span class="n">chunk</span><span class="p">,</span>
<a name="line-206"></a>                       <span class="k">const</span> <span class="n">gchar</span>  <span class="o">*</span><span class="n">string</span><span class="p">)</span>
<a name="line-207"></a><span class="p">{</span>
<a name="line-208"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">chunk</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-209"></a>
<a name="line-210"></a>  <span class="k">return</span> <span class="nf">g_string_chunk_insert_len</span> <span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="mi">-1</span><span class="p">);</span>
<a name="line-211"></a><span class="p">}</span>
<a name="line-212"></a>
<a name="line-213"></a><span class="cm">/**</span>
<a name="line-214"></a><span class="cm"> * g_string_chunk_insert_const:</span>
<a name="line-215"></a><span class="cm"> * @chunk: a #GStringChunk</span>
<a name="line-216"></a><span class="cm"> * @string: the string to add</span>
<a name="line-217"></a><span class="cm"> *</span>
<a name="line-218"></a><span class="cm"> * Adds a copy of @string to the #GStringChunk, unless the same</span>
<a name="line-219"></a><span class="cm"> * string has already been added to the #GStringChunk with</span>
<a name="line-220"></a><span class="cm"> * g_string_chunk_insert_const().</span>
<a name="line-221"></a><span class="cm"> *</span>
<a name="line-222"></a><span class="cm"> * This function is useful if you need to copy a large number</span>
<a name="line-223"></a><span class="cm"> * of strings but do not want to waste space storing duplicates.</span>
<a name="line-224"></a><span class="cm"> * But you must remember that there may be several pointers to</span>
<a name="line-225"></a><span class="cm"> * the same string, and so any changes made to the strings</span>
<a name="line-226"></a><span class="cm"> * should be done very carefully.</span>
<a name="line-227"></a><span class="cm"> *</span>
<a name="line-228"></a><span class="cm"> * Note that g_string_chunk_insert_const() will not return a</span>
<a name="line-229"></a><span class="cm"> * pointer to a string added with g_string_chunk_insert(), even</span>
<a name="line-230"></a><span class="cm"> * if they do match.</span>
<a name="line-231"></a><span class="cm"> *</span>
<a name="line-232"></a><span class="cm"> * Returns: a pointer to the new or existing copy of @string</span>
<a name="line-233"></a><span class="cm"> *     within the #GStringChunk</span>
<a name="line-234"></a><span class="cm"> */</span>
<a name="line-235"></a><span class="n">gchar</span><span class="o">*</span>
<a name="line-236"></a><span class="n">g_string_chunk_insert_const</span> <span class="p">(</span><span class="n">GStringChunk</span> <span class="o">*</span><span class="n">chunk</span><span class="p">,</span>
<a name="line-237"></a>                             <span class="k">const</span> <span class="n">gchar</span>  <span class="o">*</span><span class="n">string</span><span class="p">)</span>
<a name="line-238"></a><span class="p">{</span>
<a name="line-239"></a>  <span class="kt">char</span><span class="o">*</span> <span class="n">lookup</span><span class="p">;</span>
<a name="line-240"></a>
<a name="line-241"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">chunk</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-242"></a>
<a name="line-243"></a>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">const_table</span><span class="p">)</span>
<a name="line-244"></a>    <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">const_table</span> <span class="o">=</span> <span class="n">g_hash_table_new</span> <span class="p">(</span><span class="n">g_str_hash</span><span class="p">,</span> <span class="n">g_str_equal</span><span class="p">);</span>
<a name="line-245"></a>
<a name="line-246"></a>  <span class="n">lookup</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">g_hash_table_lookup</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">const_table</span><span class="p">,</span> <span class="p">(</span><span class="n">gchar</span> <span class="o">*</span><span class="p">)</span><span class="n">string</span><span class="p">);</span>
<a name="line-247"></a>
<a name="line-248"></a>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lookup</span><span class="p">)</span>
<a name="line-249"></a>    <span class="p">{</span>
<a name="line-250"></a>      <span class="n">lookup</span> <span class="o">=</span> <span class="n">g_string_chunk_insert</span> <span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">string</span><span class="p">);</span>
<a name="line-251"></a>      <span class="n">g_hash_table_add</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">const_table</span><span class="p">,</span> <span class="n">lookup</span><span class="p">);</span>
<a name="line-252"></a>    <span class="p">}</span>
<a name="line-253"></a>
<a name="line-254"></a>  <span class="k">return</span> <span class="n">lookup</span><span class="p">;</span>
<a name="line-255"></a><span class="p">}</span>
<a name="line-256"></a>
<a name="line-257"></a><span class="cm">/**</span>
<a name="line-258"></a><span class="cm"> * g_string_chunk_insert_len:</span>
<a name="line-259"></a><span class="cm"> * @chunk: a #GStringChunk</span>
<a name="line-260"></a><span class="cm"> * @string: bytes to insert</span>
<a name="line-261"></a><span class="cm"> * @len: number of bytes of @string to insert, or -1 to insert a</span>
<a name="line-262"></a><span class="cm"> *     nul-terminated string</span>
<a name="line-263"></a><span class="cm"> *</span>
<a name="line-264"></a><span class="cm"> * Adds a copy of the first @len bytes of @string to the #GStringChunk.</span>
<a name="line-265"></a><span class="cm"> * The copy is nul-terminated.</span>
<a name="line-266"></a><span class="cm"> *</span>
<a name="line-267"></a><span class="cm"> * Since this function does not stop at nul bytes, it is the caller&#39;s</span>
<a name="line-268"></a><span class="cm"> * responsibility to ensure that @string has at least @len addressable</span>
<a name="line-269"></a><span class="cm"> * bytes.</span>
<a name="line-270"></a><span class="cm"> *</span>
<a name="line-271"></a><span class="cm"> * The characters in the returned string can be changed, if necessary,</span>
<a name="line-272"></a><span class="cm"> * though you should not change anything after the end of the string.</span>
<a name="line-273"></a><span class="cm"> *</span>
<a name="line-274"></a><span class="cm"> * Returns: a pointer to the copy of @string within the #GStringChunk</span>
<a name="line-275"></a><span class="cm"> *</span>
<a name="line-276"></a><span class="cm"> * Since: 2.4</span>
<a name="line-277"></a><span class="cm"> */</span>
<a name="line-278"></a><span class="n">gchar</span><span class="o">*</span>
<a name="line-279"></a><span class="n">g_string_chunk_insert_len</span> <span class="p">(</span><span class="n">GStringChunk</span> <span class="o">*</span><span class="n">chunk</span><span class="p">,</span>
<a name="line-280"></a>                           <span class="k">const</span> <span class="n">gchar</span>  <span class="o">*</span><span class="n">string</span><span class="p">,</span>
<a name="line-281"></a>                           <span class="n">gssize</span>        <span class="n">len</span><span class="p">)</span>
<a name="line-282"></a><span class="p">{</span>
<a name="line-283"></a>  <span class="n">gssize</span> <span class="n">size</span><span class="p">;</span>
<a name="line-284"></a>  <span class="n">gchar</span><span class="o">*</span> <span class="n">pos</span><span class="p">;</span>
<a name="line-285"></a>
<a name="line-286"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">chunk</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-287"></a>
<a name="line-288"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-289"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">strlen</span> <span class="p">(</span><span class="n">string</span><span class="p">);</span>
<a name="line-290"></a>  <span class="k">else</span>
<a name="line-291"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
<a name="line-292"></a>
<a name="line-293"></a>  <span class="k">if</span> <span class="p">((</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_next</span> <span class="o">+</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">this_size</span><span class="p">)</span>
<a name="line-294"></a>    <span class="p">{</span>
<a name="line-295"></a>      <span class="n">gsize</span> <span class="n">new_size</span> <span class="o">=</span> <span class="n">nearest_power</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">default_size</span><span class="p">,</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<a name="line-296"></a>
<a name="line-297"></a>      <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span> <span class="o">=</span> <span class="n">g_slist_prepend</span> <span class="p">(</span><span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span><span class="p">,</span>
<a name="line-298"></a>                                             <span class="n">g_new</span> <span class="p">(</span><span class="n">gchar</span><span class="p">,</span> <span class="n">new_size</span><span class="p">));</span>
<a name="line-299"></a>
<a name="line-300"></a>      <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">this_size</span> <span class="o">=</span> <span class="n">new_size</span><span class="p">;</span>
<a name="line-301"></a>      <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_next</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="line-302"></a>    <span class="p">}</span>
<a name="line-303"></a>
<a name="line-304"></a>  <span class="n">pos</span> <span class="o">=</span> <span class="p">((</span><span class="n">gchar</span> <span class="o">*</span><span class="p">)</span> <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_list</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_next</span><span class="p">;</span>
<a name="line-305"></a>
<a name="line-306"></a>  <span class="o">*</span><span class="p">(</span><span class="n">pos</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<a name="line-307"></a>
<a name="line-308"></a>  <span class="n">memcpy</span> <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<a name="line-309"></a>
<a name="line-310"></a>  <span class="n">chunk</span><span class="o">-&gt;</span><span class="n">storage_next</span> <span class="o">+=</span> <span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-311"></a>
<a name="line-312"></a>  <span class="k">return</span> <span class="n">pos</span><span class="p">;</span>
<a name="line-313"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div> <!-- /.wrapper -->
    </div>
    <div id="footer" class="footer">
      <p>
        Cppcheck 2.3 - a tool for static C/C++ code analysis<br>
        <br>
        Internet: <a href="http://cppcheck.net">http://cppcheck.net</a><br>
        IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a><br>
      </p>
    </div>
  </body>
</html>
