
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - clib (cppcheck 2.3-1)</title>
    <link rel="stylesheet" href="style.css">
    <style>
pre { line-height: 125%; margin: 0; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(id) {
        var elements = document.querySelectorAll("." + id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("d-none");
        }
      }

      function toggleAll() {
        var elements = document.querySelectorAll("input");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var el = elements[i];

          if (el.checked) {
            el.checked = false;
          } else {
            el.checked = true;
          }

          toggleDisplay(el.id);
        }
      }
      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="header" class="header">
      <h1>Cppcheck report - clib (cppcheck 2.3-1): gio/gtlsserverconnection.c</h1>
    </div>
    <div class="wrapper">
      <div id="menu">
       <p id="filename"><a href="index.html">Defects:</a> gtlsserverconnection.c</p>
<a href="98.html#line-95"> varFuncNullUB 95</a>
    </div>
    <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cm">/* GIO - GLib Input, Output and Streaming Library</span>
<a name="line-2"></a><span class="cm"> *</span>
<a name="line-3"></a><span class="cm"> * Copyright Â© 2010 Red Hat, Inc</span>
<a name="line-4"></a><span class="cm"> *</span>
<a name="line-5"></a><span class="cm"> * This library is free software; you can redistribute it and/or</span>
<a name="line-6"></a><span class="cm"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="line-7"></a><span class="cm"> * License as published by the Free Software Foundation; either</span>
<a name="line-8"></a><span class="cm"> * version 2.1 of the License, or (at your option) any later version.</span>
<a name="line-9"></a><span class="cm"> *</span>
<a name="line-10"></a><span class="cm"> * This library is distributed in the hope that it will be useful,</span>
<a name="line-11"></a><span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="line-12"></a><span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="line-13"></a><span class="cm"> * Lesser General Public License for more details.</span>
<a name="line-14"></a><span class="cm"> *</span>
<a name="line-15"></a><span class="cm"> * You should have received a copy of the GNU Lesser General</span>
<a name="line-16"></a><span class="cm"> * Public License along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="line-17"></a><span class="cm"> */</span>
<a name="line-18"></a>
<a name="line-19"></a><span class="cp">#include</span> <span class="cpf">&quot;config.h&quot;</span><span class="cp"></span>
<a name="line-20"></a><span class="cp">#include</span> <span class="cpf">&quot;glib.h&quot;</span><span class="cp"></span>
<a name="line-21"></a>
<a name="line-22"></a><span class="cp">#include</span> <span class="cpf">&quot;gtlsserverconnection.h&quot;</span><span class="cp"></span>
<a name="line-23"></a><span class="cp">#include</span> <span class="cpf">&quot;ginitable.h&quot;</span><span class="cp"></span>
<a name="line-24"></a><span class="cp">#include</span> <span class="cpf">&quot;gioenumtypes.h&quot;</span><span class="cp"></span>
<a name="line-25"></a><span class="cp">#include</span> <span class="cpf">&quot;gsocket.h&quot;</span><span class="cp"></span>
<a name="line-26"></a><span class="cp">#include</span> <span class="cpf">&quot;gtlsbackend.h&quot;</span><span class="cp"></span>
<a name="line-27"></a><span class="cp">#include</span> <span class="cpf">&quot;gtlscertificate.h&quot;</span><span class="cp"></span>
<a name="line-28"></a><span class="cp">#include</span> <span class="cpf">&quot;glibintl.h&quot;</span><span class="cp"></span>
<a name="line-29"></a>
<a name="line-30"></a><span class="cm">/**</span>
<a name="line-31"></a><span class="cm"> * SECTION:gtlsserverconnection</span>
<a name="line-32"></a><span class="cm"> * @short_description: TLS server-side connection</span>
<a name="line-33"></a><span class="cm"> * @include: gio/gio.h</span>
<a name="line-34"></a><span class="cm"> *</span>
<a name="line-35"></a><span class="cm"> * #GTlsServerConnection is the server-side subclass of #GTlsConnection,</span>
<a name="line-36"></a><span class="cm"> * representing a server-side TLS connection.</span>
<a name="line-37"></a><span class="cm"> *</span>
<a name="line-38"></a><span class="cm"> * Since: 2.28</span>
<a name="line-39"></a><span class="cm"> */</span>
<a name="line-40"></a>
<a name="line-41"></a><span class="n">G_DEFINE_INTERFACE</span> <span class="p">(</span><span class="n">GTlsServerConnection</span><span class="p">,</span> <span class="n">g_tls_server_connection</span><span class="p">,</span> <span class="n">G_TYPE_TLS_CONNECTION</span><span class="p">)</span>
<a name="line-42"></a>
<a name="line-43"></a><span class="k">static</span> <span class="kt">void</span>
<a name="line-44"></a><span class="n">g_tls_server_connection_default_init</span> <span class="p">(</span><span class="n">GTlsServerConnectionInterface</span> <span class="o">*</span><span class="n">iface</span><span class="p">)</span>
<a name="line-45"></a><span class="p">{</span>
<a name="line-46"></a>  <span class="cm">/**</span>
<a name="line-47"></a><span class="cm">   * GTlsServerConnection:authentication-mode:</span>
<a name="line-48"></a><span class="cm">   *</span>
<a name="line-49"></a><span class="cm">   * The #GTlsAuthenticationMode for the server. This can be changed</span>
<a name="line-50"></a><span class="cm">   * before calling g_tls_connection_handshake() if you want to</span>
<a name="line-51"></a><span class="cm">   * rehandshake with a different mode from the initial handshake.</span>
<a name="line-52"></a><span class="cm">   *</span>
<a name="line-53"></a><span class="cm">   * Since: 2.28</span>
<a name="line-54"></a><span class="cm">   */</span>
<a name="line-55"></a>  <span class="n">g_object_interface_install_property</span> <span class="p">(</span><span class="n">iface</span><span class="p">,</span>
<a name="line-56"></a>				       <span class="n">g_param_spec_enum</span> <span class="p">(</span><span class="s">&quot;authentication-mode&quot;</span><span class="p">,</span>
<a name="line-57"></a>							  <span class="n">P_</span><span class="p">(</span><span class="s">&quot;Authentication Mode&quot;</span><span class="p">),</span>
<a name="line-58"></a>							  <span class="n">P_</span><span class="p">(</span><span class="s">&quot;The client authentication mode&quot;</span><span class="p">),</span>
<a name="line-59"></a>							  <span class="n">G_TYPE_TLS_AUTHENTICATION_MODE</span><span class="p">,</span>
<a name="line-60"></a>							  <span class="n">G_TLS_AUTHENTICATION_NONE</span><span class="p">,</span>
<a name="line-61"></a>							  <span class="n">G_PARAM_READWRITE</span> <span class="o">|</span>
<a name="line-62"></a>							  <span class="n">G_PARAM_STATIC_STRINGS</span><span class="p">));</span>
<a name="line-63"></a><span class="p">}</span>
<a name="line-64"></a>
<a name="line-65"></a><span class="cm">/**</span>
<a name="line-66"></a><span class="cm"> * g_tls_server_connection_new:</span>
<a name="line-67"></a><span class="cm"> * @base_io_stream: the #GIOStream to wrap</span>
<a name="line-68"></a><span class="cm"> * @certificate: (nullable): the default server certificate, or %NULL</span>
<a name="line-69"></a><span class="cm"> * @error: #GError for error reporting, or %NULL to ignore.</span>
<a name="line-70"></a><span class="cm"> *</span>
<a name="line-71"></a><span class="cm"> * Creates a new #GTlsServerConnection wrapping @base_io_stream (which</span>
<a name="line-72"></a><span class="cm"> * must have pollable input and output streams).</span>
<a name="line-73"></a><span class="cm"> *</span>
<a name="line-74"></a><span class="cm"> * See the documentation for #GTlsConnection:base-io-stream for restrictions</span>
<a name="line-75"></a><span class="cm"> * on when application code can run operations on the @base_io_stream after</span>
<a name="line-76"></a><span class="cm"> * this function has returned.</span>
<a name="line-77"></a><span class="cm"> *</span>
<a name="line-78"></a><span class="cm"> * Returns: (transfer full) (type GTlsServerConnection): the new</span>
<a name="line-79"></a><span class="cm"> * #GTlsServerConnection, or %NULL on error</span>
<a name="line-80"></a><span class="cm"> *</span>
<a name="line-81"></a><span class="cm"> * Since: 2.28</span>
<a name="line-82"></a><span class="cm"> */</span>
<a name="line-83"></a><span class="n">GIOStream</span> <span class="o">*</span>
<a name="line-84"></a><span class="n">g_tls_server_connection_new</span> <span class="p">(</span><span class="n">GIOStream</span>        <span class="o">*</span><span class="n">base_io_stream</span><span class="p">,</span>
<a name="line-85"></a>			     <span class="n">GTlsCertificate</span>  <span class="o">*</span><span class="n">certificate</span><span class="p">,</span>
<a name="line-86"></a>			     <span class="n">GError</span>          <span class="o">**</span><span class="n">error</span><span class="p">)</span>
<a name="line-87"></a><span class="p">{</span>
<a name="line-88"></a>  <span class="n">GObject</span> <span class="o">*</span><span class="n">conn</span><span class="p">;</span>
<a name="line-89"></a>  <span class="n">GTlsBackend</span> <span class="o">*</span><span class="n">backend</span><span class="p">;</span>
<a name="line-90"></a>
<a name="line-91"></a>  <span class="n">backend</span> <span class="o">=</span> <span class="n">g_tls_backend_get_default</span> <span class="p">();</span>
<a name="line-92"></a>  <span class="n">conn</span> <span class="o">=</span> <span class="n">g_initable_new</span> <span class="p">(</span><span class="n">g_tls_backend_get_server_connection_type</span> <span class="p">(</span><span class="n">backend</span><span class="p">),</span>
<a name="line-93"></a>			 <span class="nb">NULL</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span>
<a name="line-94"></a>			 <span class="s">&quot;base-io-stream&quot;</span><span class="p">,</span> <span class="n">base_io_stream</span><span class="p">,</span>
<a name="line-95"></a><span class="hll">			 <span class="s">&quot;certificate&quot;</span><span class="p">,</span> <span class="n">certificate</span><span class="p">,</span><div class="verbose expandable"><span class="error2">&lt;--- Passing NULL after the last typed argument to a variadic function leads to undefined behaviour. <span class="marker">[+]</span></span><div class="content">Passing NULL after the last typed argument to a variadic function leads to undefined behaviour.
The C99 standard, in section 7.15.1.1, states that if the type used by va_arg() is not compatible with the type of the actual next argument (as promoted according to the default argument promotions), the behavior is undefined.
The value of the NULL macro is an implementation-defined null pointer constant (7.17), which can be any integer constant expression with the value 0, or such an expression casted to (void*) (6.3.2.3). This includes values like 0, 0L, or even 0LL.
In practice on common architectures, this will cause real crashes if sizeof(int) != sizeof(void*), and NULL is defined to 0 or any other null pointer constant that promotes to int.
To reproduce you might be able to use this little code example on 64bit platforms. If the output includes &quot;ERROR&quot;, the sentinel had only 4 out of 8 bytes initialized to zero and was not detected as the final argument to stop argument processing via va_arg(). Changing the 0 to (void*)0 or 0L will make the &quot;ERROR&quot; output go away.
#include &lt;stdarg.h&gt;
#include &lt;stdio.h&gt;

void f(char *s, ...) {
    va_list ap;
    va_start(ap,s);
    for (;;) {
        char *p = va_arg(ap,char*);
        printf(&quot;%018p, %s\n&quot;, p, (long)p &amp; 255 ? p : &quot;&quot;);
        if(!p) break;
    }
    va_end(ap);
}

void g() {
    char *s2 = &quot;x&quot;;
    char *s3 = &quot;ERROR&quot;;

    // changing 0 to 0L for the 7th argument (which is intended to act as sentinel) makes the error go away on x86_64
    f(&quot;first&quot;, s2, s2, s2, s2, s2, 0, s3, (char*)0);
}

void h() {
    int i;
    volatile unsigned char a[1000];
    for (i = 0; i&lt;sizeof(a); i++)
        a[i] = -1;
}

int main() {
    h();
    g();
    return 0;
}</div></div>
</span><a name="line-96"></a>			 <span class="nb">NULL</span><span class="p">);</span>
<a name="line-97"></a>  <span class="k">return</span> <span class="nf">G_IO_STREAM</span> <span class="p">(</span><span class="n">conn</span><span class="p">);</span>
<a name="line-98"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div> <!-- /.wrapper -->
    </div>
    <div id="footer" class="footer">
      <p>
        Cppcheck 2.3 - a tool for static C/C++ code analysis<br>
        <br>
        Internet: <a href="http://cppcheck.net">http://cppcheck.net</a><br>
        IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a><br>
      </p>
    </div>
  </body>
</html>
