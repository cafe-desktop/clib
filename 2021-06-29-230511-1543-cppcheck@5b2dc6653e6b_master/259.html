
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - clib (cppcheck 2.3-1)</title>
    <link rel="stylesheet" href="style.css">
    <style>
pre { line-height: 125%; margin: 0; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(id) {
        var elements = document.querySelectorAll("." + id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("d-none");
        }
      }

      function toggleAll() {
        var elements = document.querySelectorAll("input");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var el = elements[i];

          if (el.checked) {
            el.checked = false;
          } else {
            el.checked = true;
          }

          toggleDisplay(el.id);
        }
      }
      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="header" class="header">
      <h1>Cppcheck report - clib (cppcheck 2.3-1): glib/ghmac.c</h1>
    </div>
    <div class="wrapper">
      <div id="menu">
       <p id="filename"><a href="index.html">Defects:</a> ghmac.c</p>
<a href="259.html#line-0"> toomanyconfigs 0</a><a href="259.html#line-0"> noValidConfiguration 0</a>
    </div>
    <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cm">/* ghmac.h - data hashing functions</span>
<a name="line-2"></a><span class="cm"> *</span>
<a name="line-3"></a><span class="cm"> * Copyright (C) 2011  Collabora Ltd.</span>
<a name="line-4"></a><span class="cm"> *</span>
<a name="line-5"></a><span class="cm"> * This library is free software; you can redistribute it and/or</span>
<a name="line-6"></a><span class="cm"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="line-7"></a><span class="cm"> * License as published by the Free Software Foundation; either</span>
<a name="line-8"></a><span class="cm"> * version 2.1 of the License, or (at your option) any later version.</span>
<a name="line-9"></a><span class="cm"> *</span>
<a name="line-10"></a><span class="cm"> * This library is distributed in the hope that it will be useful,</span>
<a name="line-11"></a><span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="line-12"></a><span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="line-13"></a><span class="cm"> * Lesser General Public License for more details.</span>
<a name="line-14"></a><span class="cm"> *</span>
<a name="line-15"></a><span class="cm"> * You should have received a copy of the GNU Lesser General Public License</span>
<a name="line-16"></a><span class="cm"> * along with this library; if not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="line-17"></a><span class="cm"> *</span>
<a name="line-18"></a><span class="cm"> * Author: Stef Walter &lt;stefw@collabora.co.uk&gt;</span>
<a name="line-19"></a><span class="cm"> */</span>
<a name="line-20"></a>
<a name="line-21"></a><span class="cp">#include</span> <span class="cpf">&quot;config.h&quot;</span><span class="cp"></span>
<a name="line-22"></a>
<a name="line-23"></a><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<a name="line-24"></a>
<a name="line-25"></a><span class="cp">#include</span> <span class="cpf">&quot;ghmac.h&quot;</span><span class="cp"></span>
<a name="line-26"></a>
<a name="line-27"></a><span class="cp">#include</span> <span class="cpf">&quot;glib/galloca.h&quot;</span><span class="cp"></span>
<a name="line-28"></a><span class="cp">#include</span> <span class="cpf">&quot;gatomic.h&quot;</span><span class="cp"></span>
<a name="line-29"></a><span class="cp">#include</span> <span class="cpf">&quot;gslice.h&quot;</span><span class="cp"></span>
<a name="line-30"></a><span class="cp">#include</span> <span class="cpf">&quot;gmem.h&quot;</span><span class="cp"></span>
<a name="line-31"></a><span class="cp">#include</span> <span class="cpf">&quot;gstrfuncs.h&quot;</span><span class="cp"></span>
<a name="line-32"></a><span class="cp">#include</span> <span class="cpf">&quot;gtestutils.h&quot;</span><span class="cp"></span>
<a name="line-33"></a><span class="cp">#include</span> <span class="cpf">&quot;gtypes.h&quot;</span><span class="cp"></span>
<a name="line-34"></a><span class="cp">#include</span> <span class="cpf">&quot;glibintl.h&quot;</span><span class="cp"></span>
<a name="line-35"></a>
<a name="line-36"></a>
<a name="line-37"></a><span class="cm">/**</span>
<a name="line-38"></a><span class="cm"> * SECTION:hmac</span>
<a name="line-39"></a><span class="cm"> * @title: Secure HMAC Digests</span>
<a name="line-40"></a><span class="cm"> * @short_description: computes the HMAC for data</span>
<a name="line-41"></a><span class="cm"> *</span>
<a name="line-42"></a><span class="cm"> * HMACs should be used when producing a cookie or hash based on data</span>
<a name="line-43"></a><span class="cm"> * and a key. Simple mechanisms for using SHA1 and other algorithms to</span>
<a name="line-44"></a><span class="cm"> * digest a key and data together are vulnerable to various security</span>
<a name="line-45"></a><span class="cm"> * issues.</span>
<a name="line-46"></a><span class="cm"> * [HMAC](http://en.wikipedia.org/wiki/HMAC)</span>
<a name="line-47"></a><span class="cm"> * uses algorithms like SHA1 in a secure way to produce a digest of a</span>
<a name="line-48"></a><span class="cm"> * key and data.</span>
<a name="line-49"></a><span class="cm"> *</span>
<a name="line-50"></a><span class="cm"> * Both the key and data are arbitrary byte arrays of bytes or characters.</span>
<a name="line-51"></a><span class="cm"> *</span>
<a name="line-52"></a><span class="cm"> * Support for HMAC Digests has been added in GLib 2.30, and support for SHA-512</span>
<a name="line-53"></a><span class="cm"> * in GLib 2.42. Support for SHA-384 was added in GLib 2.52.</span>
<a name="line-54"></a><span class="cm"> */</span>
<a name="line-55"></a>
<a name="line-56"></a><span class="k">struct</span> <span class="nc">_GHmac</span>
<a name="line-57"></a><span class="p">{</span>
<a name="line-58"></a>  <span class="kt">int</span> <span class="n">ref_count</span><span class="p">;</span>
<a name="line-59"></a>  <span class="n">GChecksumType</span> <span class="n">digest_type</span><span class="p">;</span>
<a name="line-60"></a>  <span class="n">GChecksum</span> <span class="o">*</span><span class="n">digesti</span><span class="p">;</span>
<a name="line-61"></a>  <span class="n">GChecksum</span> <span class="o">*</span><span class="n">digesto</span><span class="p">;</span>
<a name="line-62"></a><span class="p">};</span>
<a name="line-63"></a>
<a name="line-64"></a><span class="cm">/**</span>
<a name="line-65"></a><span class="cm"> * g_hmac_new:</span>
<a name="line-66"></a><span class="cm"> * @digest_type: the desired type of digest</span>
<a name="line-67"></a><span class="cm"> * @key: (array length=key_len): the key for the HMAC</span>
<a name="line-68"></a><span class="cm"> * @key_len: the length of the keys</span>
<a name="line-69"></a><span class="cm"> *</span>
<a name="line-70"></a><span class="cm"> * Creates a new #GHmac, using the digest algorithm @digest_type.</span>
<a name="line-71"></a><span class="cm"> * If the @digest_type is not known, %NULL is returned.</span>
<a name="line-72"></a><span class="cm"> * A #GHmac can be used to compute the HMAC of a key and an</span>
<a name="line-73"></a><span class="cm"> * arbitrary binary blob, using different hashing algorithms.</span>
<a name="line-74"></a><span class="cm"> *</span>
<a name="line-75"></a><span class="cm"> * A #GHmac works by feeding a binary blob through g_hmac_update()</span>
<a name="line-76"></a><span class="cm"> * until the data is complete; the digest can then be extracted</span>
<a name="line-77"></a><span class="cm"> * using g_hmac_get_string(), which will return the checksum as a</span>
<a name="line-78"></a><span class="cm"> * hexadecimal string; or g_hmac_get_digest(), which will return a</span>
<a name="line-79"></a><span class="cm"> * array of raw bytes. Once either g_hmac_get_string() or</span>
<a name="line-80"></a><span class="cm"> * g_hmac_get_digest() have been called on a #GHmac, the HMAC</span>
<a name="line-81"></a><span class="cm"> * will be closed and it won&#39;t be possible to call g_hmac_update()</span>
<a name="line-82"></a><span class="cm"> * on it anymore.</span>
<a name="line-83"></a><span class="cm"> *</span>
<a name="line-84"></a><span class="cm"> * Support for digests of type %G_CHECKSUM_SHA512 has been added in GLib 2.42.</span>
<a name="line-85"></a><span class="cm"> * Support for %G_CHECKSUM_SHA384 was added in GLib 2.52.</span>
<a name="line-86"></a><span class="cm"> *</span>
<a name="line-87"></a><span class="cm"> * Returns: the newly created #GHmac, or %NULL.</span>
<a name="line-88"></a><span class="cm"> *   Use g_hmac_unref() to free the memory allocated by it.</span>
<a name="line-89"></a><span class="cm"> *</span>
<a name="line-90"></a><span class="cm"> * Since: 2.30</span>
<a name="line-91"></a><span class="cm"> */</span>
<a name="line-92"></a><span class="n">GHmac</span> <span class="o">*</span>
<a name="line-93"></a><span class="nf">g_hmac_new</span> <span class="p">(</span><span class="n">GChecksumType</span>  <span class="n">digest_type</span><span class="p">,</span>
<a name="line-94"></a>            <span class="k">const</span> <span class="n">guchar</span>  <span class="o">*</span><span class="n">key</span><span class="p">,</span>
<a name="line-95"></a>            <span class="n">gsize</span>          <span class="n">key_len</span><span class="p">)</span>
<a name="line-96"></a><span class="p">{</span>
<a name="line-97"></a>  <span class="n">GChecksum</span> <span class="o">*</span><span class="n">checksum</span><span class="p">;</span>
<a name="line-98"></a>  <span class="n">GHmac</span> <span class="o">*</span><span class="n">hmac</span><span class="p">;</span>
<a name="line-99"></a>  <span class="n">guchar</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
<a name="line-100"></a>  <span class="n">guchar</span> <span class="o">*</span><span class="n">pad</span><span class="p">;</span>
<a name="line-101"></a>  <span class="n">gsize</span> <span class="n">i</span><span class="p">,</span> <span class="n">len</span><span class="p">;</span>
<a name="line-102"></a>  <span class="n">gsize</span> <span class="n">block_size</span><span class="p">;</span>
<a name="line-103"></a>
<a name="line-104"></a>  <span class="n">checksum</span> <span class="o">=</span> <span class="n">g_checksum_new</span> <span class="p">(</span><span class="n">digest_type</span><span class="p">);</span>
<a name="line-105"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">checksum</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-106"></a>
<a name="line-107"></a>  <span class="k">switch</span> <span class="p">(</span><span class="n">digest_type</span><span class="p">)</span>
<a name="line-108"></a>    <span class="p">{</span>
<a name="line-109"></a>    <span class="k">case</span> <span class="nl">G_CHECKSUM_MD5</span><span class="p">:</span>
<a name="line-110"></a>    <span class="k">case</span> <span class="nl">G_CHECKSUM_SHA1</span><span class="p">:</span>
<a name="line-111"></a>      <span class="n">block_size</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span> <span class="cm">/* RFC 2104 */</span>
<a name="line-112"></a>      <span class="k">break</span><span class="p">;</span>
<a name="line-113"></a>    <span class="k">case</span> <span class="nl">G_CHECKSUM_SHA256</span><span class="p">:</span>
<a name="line-114"></a>      <span class="n">block_size</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span> <span class="cm">/* RFC 4868 */</span>
<a name="line-115"></a>      <span class="k">break</span><span class="p">;</span>
<a name="line-116"></a>    <span class="k">case</span> <span class="nl">G_CHECKSUM_SHA384</span><span class="p">:</span>
<a name="line-117"></a>    <span class="k">case</span> <span class="nl">G_CHECKSUM_SHA512</span><span class="p">:</span>
<a name="line-118"></a>      <span class="n">block_size</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span> <span class="cm">/* RFC 4868 */</span>
<a name="line-119"></a>      <span class="k">break</span><span class="p">;</span>
<a name="line-120"></a>    <span class="k">default</span><span class="o">:</span>
<a name="line-121"></a>      <span class="n">g_return_val_if_reached</span> <span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<a name="line-122"></a>    <span class="p">}</span>
<a name="line-123"></a>
<a name="line-124"></a>  <span class="n">hmac</span> <span class="o">=</span> <span class="n">g_slice_new0</span> <span class="p">(</span><span class="n">GHmac</span><span class="p">);</span>
<a name="line-125"></a>  <span class="n">hmac</span><span class="o">-&gt;</span><span class="n">ref_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-126"></a>  <span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digest_type</span> <span class="o">=</span> <span class="n">digest_type</span><span class="p">;</span>
<a name="line-127"></a>  <span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span> <span class="o">=</span> <span class="n">checksum</span><span class="p">;</span>
<a name="line-128"></a>  <span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesto</span> <span class="o">=</span> <span class="n">g_checksum_new</span> <span class="p">(</span><span class="n">digest_type</span><span class="p">);</span>
<a name="line-129"></a>
<a name="line-130"></a>  <span class="n">buffer</span> <span class="o">=</span> <span class="n">g_alloca</span> <span class="p">(</span><span class="n">block_size</span><span class="p">);</span>
<a name="line-131"></a>  <span class="n">pad</span> <span class="o">=</span> <span class="n">g_alloca</span> <span class="p">(</span><span class="n">block_size</span><span class="p">);</span>
<a name="line-132"></a>
<a name="line-133"></a>  <span class="n">memset</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">block_size</span><span class="p">);</span>
<a name="line-134"></a>
<a name="line-135"></a>  <span class="cm">/* If the key is too long, hash it */</span>
<a name="line-136"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">key_len</span> <span class="o">&gt;</span> <span class="n">block_size</span><span class="p">)</span>
<a name="line-137"></a>    <span class="p">{</span>
<a name="line-138"></a>      <span class="n">len</span> <span class="o">=</span> <span class="n">block_size</span><span class="p">;</span>
<a name="line-139"></a>      <span class="n">g_checksum_update</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_len</span><span class="p">);</span>
<a name="line-140"></a>      <span class="n">g_checksum_get_digest</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
<a name="line-141"></a>      <span class="n">g_checksum_reset</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span><span class="p">);</span>
<a name="line-142"></a>    <span class="p">}</span>
<a name="line-143"></a>
<a name="line-144"></a>  <span class="cm">/* Otherwise pad it with zeros */</span>
<a name="line-145"></a>  <span class="k">else</span>
<a name="line-146"></a>    <span class="p">{</span>
<a name="line-147"></a>      <span class="n">memcpy</span> <span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_len</span><span class="p">);</span>
<a name="line-148"></a>    <span class="p">}</span>
<a name="line-149"></a>
<a name="line-150"></a>  <span class="cm">/* First pad */</span>
<a name="line-151"></a>  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">block_size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="line-152"></a>    <span class="n">pad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x36</span> <span class="o">^</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="cm">/* ipad value */</span>
<a name="line-153"></a>  <span class="n">g_checksum_update</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">block_size</span><span class="p">);</span>
<a name="line-154"></a>
<a name="line-155"></a>  <span class="cm">/* Second pad */</span>
<a name="line-156"></a>  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">block_size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="line-157"></a>    <span class="n">pad</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x5c</span> <span class="o">^</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="cm">/* opad value */</span>
<a name="line-158"></a>  <span class="n">g_checksum_update</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesto</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">block_size</span><span class="p">);</span>
<a name="line-159"></a>
<a name="line-160"></a>  <span class="k">return</span> <span class="n">hmac</span><span class="p">;</span>
<a name="line-161"></a><span class="p">}</span>
<a name="line-162"></a>
<a name="line-163"></a><span class="cm">/**</span>
<a name="line-164"></a><span class="cm"> * g_hmac_copy:</span>
<a name="line-165"></a><span class="cm"> * @hmac: the #GHmac to copy</span>
<a name="line-166"></a><span class="cm"> *</span>
<a name="line-167"></a><span class="cm"> * Copies a #GHmac. If @hmac has been closed, by calling</span>
<a name="line-168"></a><span class="cm"> * g_hmac_get_string() or g_hmac_get_digest(), the copied</span>
<a name="line-169"></a><span class="cm"> * HMAC will be closed as well.</span>
<a name="line-170"></a><span class="cm"> *</span>
<a name="line-171"></a><span class="cm"> * Returns: the copy of the passed #GHmac. Use g_hmac_unref()</span>
<a name="line-172"></a><span class="cm"> *   when finished using it.</span>
<a name="line-173"></a><span class="cm"> *</span>
<a name="line-174"></a><span class="cm"> * Since: 2.30</span>
<a name="line-175"></a><span class="cm"> */</span>
<a name="line-176"></a><span class="n">GHmac</span> <span class="o">*</span>
<a name="line-177"></a><span class="nf">g_hmac_copy</span> <span class="p">(</span><span class="k">const</span> <span class="n">GHmac</span> <span class="o">*</span><span class="n">hmac</span><span class="p">)</span>
<a name="line-178"></a><span class="p">{</span>
<a name="line-179"></a>  <span class="n">GHmac</span> <span class="o">*</span><span class="n">copy</span><span class="p">;</span>
<a name="line-180"></a>
<a name="line-181"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">hmac</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-182"></a>
<a name="line-183"></a>  <span class="n">copy</span> <span class="o">=</span> <span class="n">g_slice_new</span> <span class="p">(</span><span class="n">GHmac</span><span class="p">);</span>
<a name="line-184"></a>  <span class="n">copy</span><span class="o">-&gt;</span><span class="n">ref_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="line-185"></a>  <span class="n">copy</span><span class="o">-&gt;</span><span class="n">digest_type</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digest_type</span><span class="p">;</span>
<a name="line-186"></a>  <span class="n">copy</span><span class="o">-&gt;</span><span class="n">digesti</span> <span class="o">=</span> <span class="n">g_checksum_copy</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span><span class="p">);</span>
<a name="line-187"></a>  <span class="n">copy</span><span class="o">-&gt;</span><span class="n">digesto</span> <span class="o">=</span> <span class="n">g_checksum_copy</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesto</span><span class="p">);</span>
<a name="line-188"></a>
<a name="line-189"></a>  <span class="k">return</span> <span class="n">copy</span><span class="p">;</span>
<a name="line-190"></a><span class="p">}</span>
<a name="line-191"></a>
<a name="line-192"></a><span class="cm">/**</span>
<a name="line-193"></a><span class="cm"> * g_hmac_ref:</span>
<a name="line-194"></a><span class="cm"> * @hmac: a valid #GHmac</span>
<a name="line-195"></a><span class="cm"> *</span>
<a name="line-196"></a><span class="cm"> * Atomically increments the reference count of @hmac by one.</span>
<a name="line-197"></a><span class="cm"> *</span>
<a name="line-198"></a><span class="cm"> * This function is MT-safe and may be called from any thread.</span>
<a name="line-199"></a><span class="cm"> *</span>
<a name="line-200"></a><span class="cm"> * Returns: the passed in #GHmac.</span>
<a name="line-201"></a><span class="cm"> *</span>
<a name="line-202"></a><span class="cm"> * Since: 2.30</span>
<a name="line-203"></a><span class="cm"> **/</span>
<a name="line-204"></a><span class="n">GHmac</span> <span class="o">*</span>
<a name="line-205"></a><span class="nf">g_hmac_ref</span> <span class="p">(</span><span class="n">GHmac</span> <span class="o">*</span><span class="n">hmac</span><span class="p">)</span>
<a name="line-206"></a><span class="p">{</span>
<a name="line-207"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">hmac</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-208"></a>
<a name="line-209"></a>  <span class="n">g_atomic_int_inc</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">ref_count</span><span class="p">);</span>
<a name="line-210"></a>
<a name="line-211"></a>  <span class="k">return</span> <span class="n">hmac</span><span class="p">;</span>
<a name="line-212"></a><span class="p">}</span>
<a name="line-213"></a>
<a name="line-214"></a><span class="cm">/**</span>
<a name="line-215"></a><span class="cm"> * g_hmac_unref:</span>
<a name="line-216"></a><span class="cm"> * @hmac: a #GHmac</span>
<a name="line-217"></a><span class="cm"> *</span>
<a name="line-218"></a><span class="cm"> * Atomically decrements the reference count of @hmac by one.</span>
<a name="line-219"></a><span class="cm"> *</span>
<a name="line-220"></a><span class="cm"> * If the reference count drops to 0, all keys and values will be</span>
<a name="line-221"></a><span class="cm"> * destroyed, and all memory allocated by the hash table is released.</span>
<a name="line-222"></a><span class="cm"> * This function is MT-safe and may be called from any thread.</span>
<a name="line-223"></a><span class="cm"> * Frees the memory allocated for @hmac.</span>
<a name="line-224"></a><span class="cm"> *</span>
<a name="line-225"></a><span class="cm"> * Since: 2.30</span>
<a name="line-226"></a><span class="cm"> */</span>
<a name="line-227"></a><span class="kt">void</span>
<a name="line-228"></a><span class="nf">g_hmac_unref</span> <span class="p">(</span><span class="n">GHmac</span> <span class="o">*</span><span class="n">hmac</span><span class="p">)</span>
<a name="line-229"></a><span class="p">{</span>
<a name="line-230"></a>  <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">hmac</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-231"></a>
<a name="line-232"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">g_atomic_int_dec_and_test</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">ref_count</span><span class="p">))</span>
<a name="line-233"></a>    <span class="p">{</span>
<a name="line-234"></a>      <span class="n">g_checksum_free</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span><span class="p">);</span>
<a name="line-235"></a>      <span class="n">g_checksum_free</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesto</span><span class="p">);</span>
<a name="line-236"></a>      <span class="n">g_slice_free</span> <span class="p">(</span><span class="n">GHmac</span><span class="p">,</span> <span class="n">hmac</span><span class="p">);</span>
<a name="line-237"></a>    <span class="p">}</span>
<a name="line-238"></a><span class="p">}</span>
<a name="line-239"></a>
<a name="line-240"></a><span class="cm">/**</span>
<a name="line-241"></a><span class="cm"> * g_hmac_update:</span>
<a name="line-242"></a><span class="cm"> * @hmac: a #GHmac</span>
<a name="line-243"></a><span class="cm"> * @data: (array length=length): buffer used to compute the checksum</span>
<a name="line-244"></a><span class="cm"> * @length: size of the buffer, or -1 if it is a nul-terminated string</span>
<a name="line-245"></a><span class="cm"> *</span>
<a name="line-246"></a><span class="cm"> * Feeds @data into an existing #GHmac.</span>
<a name="line-247"></a><span class="cm"> *</span>
<a name="line-248"></a><span class="cm"> * The HMAC must still be open, that is g_hmac_get_string() or</span>
<a name="line-249"></a><span class="cm"> * g_hmac_get_digest() must not have been called on @hmac.</span>
<a name="line-250"></a><span class="cm"> *</span>
<a name="line-251"></a><span class="cm"> * Since: 2.30</span>
<a name="line-252"></a><span class="cm"> */</span>
<a name="line-253"></a><span class="kt">void</span>
<a name="line-254"></a><span class="nf">g_hmac_update</span> <span class="p">(</span><span class="n">GHmac</span>        <span class="o">*</span><span class="n">hmac</span><span class="p">,</span>
<a name="line-255"></a>               <span class="k">const</span> <span class="n">guchar</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
<a name="line-256"></a>               <span class="n">gssize</span>        <span class="n">length</span><span class="p">)</span>
<a name="line-257"></a><span class="p">{</span>
<a name="line-258"></a>  <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">hmac</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-259"></a>  <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-260"></a>
<a name="line-261"></a>  <span class="n">g_checksum_update</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
<a name="line-262"></a><span class="p">}</span>
<a name="line-263"></a>
<a name="line-264"></a><span class="cm">/**</span>
<a name="line-265"></a><span class="cm"> * g_hmac_get_string:</span>
<a name="line-266"></a><span class="cm"> * @hmac: a #GHmac</span>
<a name="line-267"></a><span class="cm"> *</span>
<a name="line-268"></a><span class="cm"> * Gets the HMAC as a hexadecimal string.</span>
<a name="line-269"></a><span class="cm"> *</span>
<a name="line-270"></a><span class="cm"> * Once this function has been called the #GHmac can no longer be</span>
<a name="line-271"></a><span class="cm"> * updated with g_hmac_update().</span>
<a name="line-272"></a><span class="cm"> *</span>
<a name="line-273"></a><span class="cm"> * The hexadecimal characters will be lower case.</span>
<a name="line-274"></a><span class="cm"> *</span>
<a name="line-275"></a><span class="cm"> * Returns: the hexadecimal representation of the HMAC. The</span>
<a name="line-276"></a><span class="cm"> *   returned string is owned by the HMAC and should not be modified</span>
<a name="line-277"></a><span class="cm"> *   or freed.</span>
<a name="line-278"></a><span class="cm"> *</span>
<a name="line-279"></a><span class="cm"> * Since: 2.30</span>
<a name="line-280"></a><span class="cm"> */</span>
<a name="line-281"></a><span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span>
<a name="line-282"></a><span class="n">g_hmac_get_string</span> <span class="p">(</span><span class="n">GHmac</span> <span class="o">*</span><span class="n">hmac</span><span class="p">)</span>
<a name="line-283"></a><span class="p">{</span>
<a name="line-284"></a>  <span class="n">guint8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
<a name="line-285"></a>  <span class="n">gsize</span> <span class="n">digest_len</span><span class="p">;</span>
<a name="line-286"></a>
<a name="line-287"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">hmac</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-288"></a>
<a name="line-289"></a>  <span class="n">digest_len</span> <span class="o">=</span> <span class="n">g_checksum_type_get_length</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digest_type</span><span class="p">);</span>
<a name="line-290"></a>  <span class="n">buffer</span> <span class="o">=</span> <span class="n">g_alloca</span> <span class="p">(</span><span class="n">digest_len</span><span class="p">);</span>
<a name="line-291"></a>
<a name="line-292"></a>  <span class="cm">/* This is only called for its side-effect of updating hmac-&gt;digesto... */</span>
<a name="line-293"></a>  <span class="n">g_hmac_get_digest</span> <span class="p">(</span><span class="n">hmac</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">digest_len</span><span class="p">);</span>
<a name="line-294"></a>  <span class="cm">/* ... because we get the string from the checksum rather than</span>
<a name="line-295"></a><span class="cm">   * stringifying buffer ourselves</span>
<a name="line-296"></a><span class="cm">   */</span>
<a name="line-297"></a>  <span class="k">return</span> <span class="nf">g_checksum_get_string</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesto</span><span class="p">);</span>
<a name="line-298"></a><span class="p">}</span>
<a name="line-299"></a>
<a name="line-300"></a><span class="cm">/**</span>
<a name="line-301"></a><span class="cm"> * g_hmac_get_digest:</span>
<a name="line-302"></a><span class="cm"> * @hmac: a #GHmac</span>
<a name="line-303"></a><span class="cm"> * @buffer: (array length=digest_len): output buffer</span>
<a name="line-304"></a><span class="cm"> * @digest_len: (inout): an inout parameter. The caller initializes it to the</span>
<a name="line-305"></a><span class="cm"> *   size of @buffer. After the call it contains the length of the digest</span>
<a name="line-306"></a><span class="cm"> *</span>
<a name="line-307"></a><span class="cm"> * Gets the digest from @checksum as a raw binary array and places it</span>
<a name="line-308"></a><span class="cm"> * into @buffer. The size of the digest depends on the type of checksum.</span>
<a name="line-309"></a><span class="cm"> *</span>
<a name="line-310"></a><span class="cm"> * Once this function has been called, the #GHmac is closed and can</span>
<a name="line-311"></a><span class="cm"> * no longer be updated with g_checksum_update().</span>
<a name="line-312"></a><span class="cm"> *</span>
<a name="line-313"></a><span class="cm"> * Since: 2.30</span>
<a name="line-314"></a><span class="cm"> */</span>
<a name="line-315"></a><span class="kt">void</span>
<a name="line-316"></a><span class="n">g_hmac_get_digest</span> <span class="p">(</span><span class="n">GHmac</span>  <span class="o">*</span><span class="n">hmac</span><span class="p">,</span>
<a name="line-317"></a>                   <span class="n">guint8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
<a name="line-318"></a>                   <span class="n">gsize</span>  <span class="o">*</span><span class="n">digest_len</span><span class="p">)</span>
<a name="line-319"></a><span class="p">{</span>
<a name="line-320"></a>  <span class="n">gsize</span> <span class="n">len</span><span class="p">;</span>
<a name="line-321"></a>
<a name="line-322"></a>  <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">hmac</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-323"></a>
<a name="line-324"></a>  <span class="n">len</span> <span class="o">=</span> <span class="n">g_checksum_type_get_length</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digest_type</span><span class="p">);</span>
<a name="line-325"></a>  <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="o">*</span><span class="n">digest_len</span> <span class="o">&gt;=</span> <span class="n">len</span><span class="p">);</span>
<a name="line-326"></a>
<a name="line-327"></a>  <span class="cm">/* Use the same buffer, because we can :) */</span>
<a name="line-328"></a>  <span class="n">g_checksum_get_digest</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesti</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
<a name="line-329"></a>  <span class="n">g_checksum_update</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesto</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<a name="line-330"></a>  <span class="n">g_checksum_get_digest</span> <span class="p">(</span><span class="n">hmac</span><span class="o">-&gt;</span><span class="n">digesto</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">digest_len</span><span class="p">);</span>
<a name="line-331"></a><span class="p">}</span>
<a name="line-332"></a>
<a name="line-333"></a><span class="cm">/**</span>
<a name="line-334"></a><span class="cm"> * g_compute_hmac_for_data:</span>
<a name="line-335"></a><span class="cm"> * @digest_type: a #GChecksumType to use for the HMAC</span>
<a name="line-336"></a><span class="cm"> * @key: (array length=key_len): the key to use in the HMAC</span>
<a name="line-337"></a><span class="cm"> * @key_len: the length of the key</span>
<a name="line-338"></a><span class="cm"> * @data: (array length=length): binary blob to compute the HMAC of</span>
<a name="line-339"></a><span class="cm"> * @length: length of @data</span>
<a name="line-340"></a><span class="cm"> *</span>
<a name="line-341"></a><span class="cm"> * Computes the HMAC for a binary @data of @length. This is a</span>
<a name="line-342"></a><span class="cm"> * convenience wrapper for g_hmac_new(), g_hmac_get_string()</span>
<a name="line-343"></a><span class="cm"> * and g_hmac_unref().</span>
<a name="line-344"></a><span class="cm"> *</span>
<a name="line-345"></a><span class="cm"> * The hexadecimal string returned will be in lower case.</span>
<a name="line-346"></a><span class="cm"> *</span>
<a name="line-347"></a><span class="cm"> * Returns: the HMAC of the binary data as a string in hexadecimal.</span>
<a name="line-348"></a><span class="cm"> *   The returned string should be freed with g_free() when done using it.</span>
<a name="line-349"></a><span class="cm"> *</span>
<a name="line-350"></a><span class="cm"> * Since: 2.30</span>
<a name="line-351"></a><span class="cm"> */</span>
<a name="line-352"></a><span class="n">gchar</span> <span class="o">*</span>
<a name="line-353"></a><span class="n">g_compute_hmac_for_data</span> <span class="p">(</span><span class="n">GChecksumType</span>  <span class="n">digest_type</span><span class="p">,</span>
<a name="line-354"></a>                         <span class="k">const</span> <span class="n">guchar</span>  <span class="o">*</span><span class="n">key</span><span class="p">,</span>
<a name="line-355"></a>                         <span class="n">gsize</span>          <span class="n">key_len</span><span class="p">,</span>
<a name="line-356"></a>                         <span class="k">const</span> <span class="n">guchar</span>  <span class="o">*</span><span class="n">data</span><span class="p">,</span>
<a name="line-357"></a>                         <span class="n">gsize</span>          <span class="n">length</span><span class="p">)</span>
<a name="line-358"></a><span class="p">{</span>
<a name="line-359"></a>  <span class="n">GHmac</span> <span class="o">*</span><span class="n">hmac</span><span class="p">;</span>
<a name="line-360"></a>  <span class="n">gchar</span> <span class="o">*</span><span class="n">retval</span><span class="p">;</span>
<a name="line-361"></a>
<a name="line-362"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-363"></a>
<a name="line-364"></a>  <span class="n">hmac</span> <span class="o">=</span> <span class="n">g_hmac_new</span> <span class="p">(</span><span class="n">digest_type</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_len</span><span class="p">);</span>
<a name="line-365"></a>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hmac</span><span class="p">)</span>
<a name="line-366"></a>    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-367"></a>
<a name="line-368"></a>  <span class="n">g_hmac_update</span> <span class="p">(</span><span class="n">hmac</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
<a name="line-369"></a>  <span class="n">retval</span> <span class="o">=</span> <span class="n">g_strdup</span> <span class="p">(</span><span class="n">g_hmac_get_string</span> <span class="p">(</span><span class="n">hmac</span><span class="p">));</span>
<a name="line-370"></a>  <span class="n">g_hmac_unref</span> <span class="p">(</span><span class="n">hmac</span><span class="p">);</span>
<a name="line-371"></a>
<a name="line-372"></a>  <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<a name="line-373"></a><span class="p">}</span>
<a name="line-374"></a>
<a name="line-375"></a><span class="cm">/**</span>
<a name="line-376"></a><span class="cm"> * g_compute_hmac_for_bytes:</span>
<a name="line-377"></a><span class="cm"> * @digest_type: a #GChecksumType to use for the HMAC</span>
<a name="line-378"></a><span class="cm"> * @key: the key to use in the HMAC</span>
<a name="line-379"></a><span class="cm"> * @data: binary blob to compute the HMAC of</span>
<a name="line-380"></a><span class="cm"> *</span>
<a name="line-381"></a><span class="cm"> * Computes the HMAC for a binary @data. This is a</span>
<a name="line-382"></a><span class="cm"> * convenience wrapper for g_hmac_new(), g_hmac_get_string()</span>
<a name="line-383"></a><span class="cm"> * and g_hmac_unref().</span>
<a name="line-384"></a><span class="cm"> *</span>
<a name="line-385"></a><span class="cm"> * The hexadecimal string returned will be in lower case.</span>
<a name="line-386"></a><span class="cm"> *</span>
<a name="line-387"></a><span class="cm"> * Returns: the HMAC of the binary data as a string in hexadecimal.</span>
<a name="line-388"></a><span class="cm"> *   The returned string should be freed with g_free() when done using it.</span>
<a name="line-389"></a><span class="cm"> *</span>
<a name="line-390"></a><span class="cm"> * Since: 2.50</span>
<a name="line-391"></a><span class="cm"> */</span>
<a name="line-392"></a><span class="n">gchar</span> <span class="o">*</span>
<a name="line-393"></a><span class="n">g_compute_hmac_for_bytes</span> <span class="p">(</span><span class="n">GChecksumType</span>  <span class="n">digest_type</span><span class="p">,</span>
<a name="line-394"></a>                          <span class="n">GBytes</span>        <span class="o">*</span><span class="n">key</span><span class="p">,</span>
<a name="line-395"></a>                          <span class="n">GBytes</span>        <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<a name="line-396"></a><span class="p">{</span>
<a name="line-397"></a>  <span class="n">gconstpointer</span> <span class="n">byte_data</span><span class="p">;</span>
<a name="line-398"></a>  <span class="n">gsize</span> <span class="n">length</span><span class="p">;</span>
<a name="line-399"></a>  <span class="n">gconstpointer</span> <span class="n">key_data</span><span class="p">;</span>
<a name="line-400"></a>  <span class="n">gsize</span> <span class="n">key_len</span><span class="p">;</span>
<a name="line-401"></a>
<a name="line-402"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">data</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-403"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">key</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-404"></a>
<a name="line-405"></a>  <span class="n">byte_data</span> <span class="o">=</span> <span class="n">g_bytes_get_data</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">length</span><span class="p">);</span>
<a name="line-406"></a>  <span class="n">key_data</span> <span class="o">=</span> <span class="n">g_bytes_get_data</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key_len</span><span class="p">);</span>
<a name="line-407"></a>  <span class="k">return</span> <span class="nf">g_compute_hmac_for_data</span> <span class="p">(</span><span class="n">digest_type</span><span class="p">,</span> <span class="n">key_data</span><span class="p">,</span> <span class="n">key_len</span><span class="p">,</span> <span class="n">byte_data</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
<a name="line-408"></a><span class="p">}</span>
<a name="line-409"></a>
<a name="line-410"></a>
<a name="line-411"></a><span class="cm">/**</span>
<a name="line-412"></a><span class="cm"> * g_compute_hmac_for_string:</span>
<a name="line-413"></a><span class="cm"> * @digest_type: a #GChecksumType to use for the HMAC</span>
<a name="line-414"></a><span class="cm"> * @key: (array length=key_len): the key to use in the HMAC</span>
<a name="line-415"></a><span class="cm"> * @key_len: the length of the key</span>
<a name="line-416"></a><span class="cm"> * @str: the string to compute the HMAC for</span>
<a name="line-417"></a><span class="cm"> * @length: the length of the string, or -1 if the string is nul-terminated</span>
<a name="line-418"></a><span class="cm"> *</span>
<a name="line-419"></a><span class="cm"> * Computes the HMAC for a string.</span>
<a name="line-420"></a><span class="cm"> *</span>
<a name="line-421"></a><span class="cm"> * The hexadecimal string returned will be in lower case.</span>
<a name="line-422"></a><span class="cm"> *</span>
<a name="line-423"></a><span class="cm"> * Returns: the HMAC as a hexadecimal string.</span>
<a name="line-424"></a><span class="cm"> *     The returned string should be freed with g_free()</span>
<a name="line-425"></a><span class="cm"> *     when done using it.</span>
<a name="line-426"></a><span class="cm"> *</span>
<a name="line-427"></a><span class="cm"> * Since: 2.30</span>
<a name="line-428"></a><span class="cm"> */</span>
<a name="line-429"></a><span class="n">gchar</span> <span class="o">*</span>
<a name="line-430"></a><span class="n">g_compute_hmac_for_string</span> <span class="p">(</span><span class="n">GChecksumType</span>  <span class="n">digest_type</span><span class="p">,</span>
<a name="line-431"></a>                           <span class="k">const</span> <span class="n">guchar</span>  <span class="o">*</span><span class="n">key</span><span class="p">,</span>
<a name="line-432"></a>                           <span class="n">gsize</span>          <span class="n">key_len</span><span class="p">,</span>
<a name="line-433"></a>                           <span class="k">const</span> <span class="n">gchar</span>   <span class="o">*</span><span class="n">str</span><span class="p">,</span>
<a name="line-434"></a>                           <span class="n">gssize</span>         <span class="n">length</span><span class="p">)</span>
<a name="line-435"></a><span class="p">{</span>
<a name="line-436"></a>  <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">str</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-437"></a>
<a name="line-438"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-439"></a>    <span class="n">length</span> <span class="o">=</span> <span class="n">strlen</span> <span class="p">(</span><span class="n">str</span><span class="p">);</span>
<a name="line-440"></a>
<a name="line-441"></a>  <span class="k">return</span> <span class="nf">g_compute_hmac_for_data</span> <span class="p">(</span><span class="n">digest_type</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key_len</span><span class="p">,</span>
<a name="line-442"></a>                                  <span class="p">(</span><span class="k">const</span> <span class="n">guchar</span> <span class="o">*</span><span class="p">)</span> <span class="n">str</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
<a name="line-443"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div> <!-- /.wrapper -->
    </div>
    <div id="footer" class="footer">
      <p>
        Cppcheck 2.3 - a tool for static C/C++ code analysis<br>
        <br>
        Internet: <a href="http://cppcheck.net">http://cppcheck.net</a><br>
        IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a><br>
      </p>
    </div>
  </body>
</html>
